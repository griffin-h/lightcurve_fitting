<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usage &mdash; Light Curve Fitting 0.8.0.post1+ge77e541 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Documentation" href="api.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Light Curve Fitting
          </a>
              <div class="version">
                0.8.0.post1+ge77e541
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#light-curves">Light Curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filters">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bolometric-light-curves">Bolometric Light Curves</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#intrinsic-scatter">Intrinsic Scatter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-fitting">Model Fitting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defining-new-models-advanced">Defining New Models (Advanced)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#calibrating-spectra-to-photometry">Calibrating Spectra to Photometry</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Light Curve Fitting</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h1>
<section id="light-curves">
<h2>Light Curves<a class="headerlink" href="#light-curves" title="Permalink to this heading">¶</a></h2>
<p>The core of this package is the <a class="reference internal" href="api.html#lightcurve_fitting.lightcurve.LC" title="lightcurve_fitting.lightcurve.LC"><code class="xref py py-class docutils literal notranslate"><span class="pre">lightcurve.LC</span></code></a> object. This is an extension of the <a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v5.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">astropy.table.Table</span></code></a> object, which contains
tabular data, in this case broadband photometric observations. You can read light curve data from a file using the
standard <code class="xref py py-meth docutils literal notranslate"><span class="pre">astropy.table.Table.read()</span></code> method. I’m going to read an example light curve of SN 2016bkv to be used from here on:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightcurve_fitting.lightcurve</span> <span class="kn">import</span> <span class="n">LC</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;example/SN2016bkv.txt&#39;</span>
<span class="n">lc</span> <span class="o">=</span> <span class="n">LC</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
</pre></div>
</div>
<p>The following column names are used by the package, although the light curve can have extra columns
[alternative column names are given in square brackets]:</p>
<blockquote>
<div><ul class="simple">
<li><p>MJD (required): modified Julian date of the observation [mjd, JD, jd (JD/jd are converted)]</p></li>
<li><p>mag (required): magnitude of the observation [Magnitude, Mag, ab_mag, PSFmag, MAG, omag, magnitude, apparent_mag]</p></li>
<li><p>dmag (required): uncertainty on the magnitude [Magnitude_Error, magerr, MagErr, mag_err, e_mag, Error, err, PSFerr,
MAGERR, e_omag, e_magnitude, apparent_mag_err, Mag_Err, emag]</p></li>
<li><p>filter (required): name of the filter [filter, filt Filter, band, FLT, Band] (see <a class="reference internal" href="#filters"><span class="std std-ref">Filters</span></a> below)</p></li>
<li><p>nondet: True if the magnitude is an upper limit, False otherwise [Is_Limit, UL, l_omag, upper_limit, upperlimit]</p></li>
<li><p>flux: the spectral flux density (<span class="math notranslate nohighlight">\(F_ν\)</span>, arbitrary units) of the observation [FLUXCAL]</p></li>
<li><p>dflux: uncertainty on the flux [FLUXCALERR]</p></li>
<li><p>phase: time since a reference date (e.g., peak or explosion) in rest-frame days [Phase, PHASE]</p></li>
<li><p>absmag: absolute magnitude of the observation</p></li>
<li><p>lum: the spectral luminosity density (<span class="math notranslate nohighlight">\(L_ν\)</span>, in watts/hertz) of the observation</p></li>
<li><p>dlum: the uncertainty on the spectral luminosity density</p></li>
<li><p>telescope: the name of the telescope/instrument where this observation was carried out [Telescope, Tel, tel+inst]</p></li>
<li><p>source: the data source, either a telescope/instrument name or a literature reference [Source]</p></li>
</ul>
</div></blockquote>
<p>The <code class="xref py py-attr docutils literal notranslate"><span class="pre">LC.meta</span></code> attribute contains information needed to calculate absolute magnitudes, luminosities, and rest-frame phases:</p>
<blockquote>
<div><ul class="simple">
<li><p>dm: the distance modulus</p></li>
<li><p>ebv: the selective extinction due to dust in the Milky Way</p></li>
<li><p>host_ebv: the selective extinction due to dust in the host galaxy (applied at the target redshift)</p></li>
<li><p>redshift: the redshift (also used to calculate distance if the distance modulus is not given)</p></li>
</ul>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">30.79</span>
<span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;ebv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.016</span>
<span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;host_ebv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.002</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="api.html#lightcurve_fitting.lightcurve.LC" title="lightcurve_fitting.lightcurve.LC"><code class="xref py py-class docutils literal notranslate"><span class="pre">LC</span></code></a> object has several methods for converting between the columns above,
as well as a method for plotting the light curve in a single command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lc</span><span class="o">.</span><span class="n">calcAbsMag</span><span class="p">()</span>
<span class="n">lc</span><span class="o">.</span><span class="n">calcPhase</span><span class="p">()</span>
<span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="filters">
<h2>Filters<a class="headerlink" href="#filters" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="api.html#module-lightcurve_fitting.filters" title="lightcurve_fitting.filters"><code class="xref py py-mod docutils literal notranslate"><span class="pre">filters</span></code></a> submodule defines a <a class="reference internal" href="api.html#lightcurve_fitting.filters.Filter" title="lightcurve_fitting.filters.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> object that stores information about the broadband filters: transmission function, photometric system, and styles for plotting.
You mostly won’t have to touch this module, unless you are adding or modifying filters.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">'filter'</span></code> column in a <a class="reference internal" href="api.html#lightcurve_fitting.lightcurve.LC" title="lightcurve_fitting.lightcurve.LC"><code class="xref py py-class docutils literal notranslate"><span class="pre">LC</span></code></a> object contains <a class="reference internal" href="api.html#lightcurve_fitting.filters.Filter" title="lightcurve_fitting.filters.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> objects, rather than strings.
However, you can use filter names directly in most places, including the <a class="reference internal" href="api.html#lightcurve_fitting.lightcurve.LC.where" title="lightcurve_fitting.lightcurve.LC.where"><code class="xref py py-meth docutils literal notranslate"><span class="pre">LC.where()</span></code></a> method, and they will be parsed into <a class="reference internal" href="api.html#lightcurve_fitting.filters.Filter" title="lightcurve_fitting.filters.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> objects.
For example, <code class="docutils literal notranslate"><span class="pre">lc.where(filter='r')</span></code> will return photometry points in bands labeled both ‘r’ and ‘rp’ in your input file.</p>
<p>If you ever need direct access to the <a class="reference internal" href="api.html#lightcurve_fitting.filters.Filter" title="lightcurve_fitting.filters.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> objects by name, you can use the filter lookup dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightcurve_fitting.filters</span> <span class="kn">import</span> <span class="n">filtdict</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">filtdict</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="bolometric-light-curves">
<h2>Bolometric Light Curves<a class="headerlink" href="#bolometric-light-curves" title="Permalink to this heading">¶</a></h2>
<p>You can make a bolometric light curve and color curves from the photometry table with the <a class="reference internal" href="api.html#module-lightcurve_fitting.bolometric" title="lightcurve_fitting.bolometric"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bolometric</span></code></a> module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightcurve_fitting.bolometric</span> <span class="kn">import</span> <span class="n">calculate_bolometric</span><span class="p">,</span> <span class="n">plot_bolometric_results</span><span class="p">,</span> <span class="n">plot_color_curves</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">calculate_bolometric</span><span class="p">(</span><span class="n">lc</span><span class="p">,</span> <span class="n">outpath</span><span class="o">=</span><span class="s1">&#39;./SN2016bkv_bolometric&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;B-V&#39;</span><span class="p">,</span> <span class="s1">&#39;g-r&#39;</span><span class="p">,</span> <span class="s1">&#39;r-i&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">plot_bolometric_results</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">plot_color_curves</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>The light curve is divided into epochs (defined by the <code class="docutils literal notranslate"><span class="pre">bin</span></code> and <code class="docutils literal notranslate"><span class="pre">also_group_by</span></code> arguments to <a class="reference internal" href="api.html#lightcurve_fitting.bolometric.calculate_bolometric" title="lightcurve_fitting.bolometric.calculate_bolometric"><code class="xref py py-func docutils literal notranslate"><span class="pre">calculate_bolometric()</span></code></a>), and processed four different ways:</p>
<blockquote>
<div><ul class="simple">
<li><p>Fitting the Planck function using <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html#scipy.optimize.curve_fit" title="(in SciPy v1.10.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit()</span></code></a>. This is very fast but may not give reliable uncertainties.
The columns <code class="docutils literal notranslate"><span class="pre">temp</span></code>, <code class="docutils literal notranslate"><span class="pre">radius</span></code>, <code class="docutils literal notranslate"><span class="pre">dtemp</span></code>, and <code class="docutils literal notranslate"><span class="pre">dradius</span></code> come from this fit.</p></li>
<li><p>The Stefan-Bolzmann law gives the total bolometric luminosity, <code class="docutils literal notranslate"><span class="pre">lum</span></code> and <code class="docutils literal notranslate"><span class="pre">dlum</span></code>.</p></li>
<li><p>Integrating the Planck function between <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(I\)</span> band (observed) gives <code class="docutils literal notranslate"><span class="pre">L_opt</span></code>.</p></li>
<li><p>Fitting the Planck function using an MCMC routine.
This is slower, depending on how many walkers (<code class="docutils literal notranslate"><span class="pre">nwalkers</span></code>) and steps (<code class="docutils literal notranslate"><span class="pre">burnin_steps</span></code> and <code class="docutils literal notranslate"><span class="pre">steps</span></code>) you use,
but gives more robust uncertainties.
The columns <code class="docutils literal notranslate"><span class="pre">temp_mcmc</span></code>, <code class="docutils literal notranslate"><span class="pre">radius_mcmc</span></code>, <code class="docutils literal notranslate"><span class="pre">dtemp0</span></code>, <code class="docutils literal notranslate"><span class="pre">dtemp1</span></code>, <code class="docutils literal notranslate"><span class="pre">dradius0</span></code>, <code class="docutils literal notranslate"><span class="pre">dradius1</span></code> come from this fit.
My convention for non-Gaussian uncertainties is that 0 is the lower uncertainty and 1 is the upper uncertainty.</p></li>
<li><p>Integrating the Planck function between <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(I\)</span> band (observed) gives
<code class="docutils literal notranslate"><span class="pre">L_mcmc</span></code>, <code class="docutils literal notranslate"><span class="pre">dL_mcmc0</span></code>, and <code class="docutils literal notranslate"><span class="pre">dL_mcmc1</span></code>.</p></li>
<li><p>Directly integrating the observed SED, assuming 0 flux outside of <span class="math notranslate nohighlight">\(U\)</span> to <span class="math notranslate nohighlight">\(I\)</span>.
Use this if you do not want to assume the SED is a blackbody. This yields the column <code class="docutils literal notranslate"><span class="pre">L_int</span></code>.</p></li>
</ul>
</div></blockquote>
<p>The MCMC routine saves a corner plot for each fit in the folder you specify (<code class="docutils literal notranslate"><span class="pre">outpath</span></code>).
I highly recommend looking through these to make sure the fits converged.
If they didn’t, try adjusting the number of burn-in steps (<code class="docutils literal notranslate"><span class="pre">burnin_steps</span></code>).
To save the table, give <code class="docutils literal notranslate"><span class="pre">save_table_as='filename.table'</span></code> as an argument to <a class="reference internal" href="api.html#lightcurve_fitting.bolometric.calculate_bolometric" title="lightcurve_fitting.bolometric.calculate_bolometric"><code class="xref py py-func docutils literal notranslate"><span class="pre">calculate_bolometric()</span></code></a>.
To save the plot, give <code class="docutils literal notranslate"><span class="pre">save_plot_as='filename.pdf'</span></code> as an argument to <a class="reference internal" href="api.html#lightcurve_fitting.bolometric.plot_bolometric_results" title="lightcurve_fitting.bolometric.plot_bolometric_results"><code class="xref py py-func docutils literal notranslate"><span class="pre">plot_bolometric_results()</span></code></a>.</p>
<p>Beware of the units I’m using:</p>
<blockquote>
<div><ul class="simple">
<li><p>Temperatures are in kilokelvins (kK).</p></li>
<li><p>Radii are in thousands of solar radii (<span class="math notranslate nohighlight">\(1000R_\odot\)</span>).</p></li>
<li><p>Luminosities are in watts (W). <span class="math notranslate nohighlight">\(1\,\mathrm{W} = 10^7\,\mathrm{erg}\,\mathrm{s}^{-1}\)</span></p></li>
</ul>
</div></blockquote>
<p>Optionally, you can calculate colors at each epoch by giving the argument <code class="docutils literal notranslate"><span class="pre">colors</span></code> to <a class="reference internal" href="api.html#lightcurve_fitting.bolometric.calculate_bolometric" title="lightcurve_fitting.bolometric.calculate_bolometric"><code class="xref py py-func docutils literal notranslate"><span class="pre">calculate_bolometric()</span></code></a>. These get saved in the same output table in four columns per color, e.g., for <span class="math notranslate nohighlight">\(B-V\)</span>:</p>
<blockquote>
<div><ul class="simple">
<li><p>the color itself, <code class="docutils literal notranslate"><span class="pre">B-V</span></code>,</p></li>
<li><p>the uncertainty on the color, <code class="docutils literal notranslate"><span class="pre">d(B-V)</span></code>,</p></li>
<li><p>whether the color is a lower limit, <code class="docutils literal notranslate"><span class="pre">lolims(B-V)</span></code> (i.e., <span class="math notranslate nohighlight">\(B\)</span> was an upper limit), and</p></li>
<li><p>whether the color is an upper limit, <code class="docutils literal notranslate"><span class="pre">uplims(B-V)</span></code> (i.e., <span class="math notranslate nohighlight">\(V\)</span> was an upper limit).</p></li>
</ul>
</div></blockquote>
<section id="intrinsic-scatter">
<h3>Intrinsic Scatter<a class="headerlink" href="#intrinsic-scatter" title="Permalink to this heading">¶</a></h3>
<p>You can include an intrinsic scatter term (<span class="math notranslate nohighlight">\(\sigma\)</span>) in your MCMC fits by setting <code class="docutils literal notranslate"><span class="pre">use_sigma=True</span></code>. <span class="math notranslate nohighlight">\(\sigma\)</span> is added in quadrature to the photometric uncertainty on each point (<span class="math notranslate nohighlight">\(\sigma_i\)</span>). If you choose <code class="docutils literal notranslate"><span class="pre">sigma_type='relative'</span></code>, <span class="math notranslate nohighlight">\(\sigma\)</span> will be in units of the individual photometric uncertainties, i.e.,</p>
<div class="math notranslate nohighlight">
\[\sigma_{i,\mathrm{eff}} = \sqrt{ \sigma_i^2 + \left( \sigma * \sigma_i \right)^2 }\]</div>
<p>If you choose <code class="docutils literal notranslate"><span class="pre">sigma_type='absolute'</span></code>, <span class="math notranslate nohighlight">\(\sigma\)</span> will be in units of the median photometric uncertainty (<span class="math notranslate nohighlight">\(\bar\sigma\)</span>), i.e.,</p>
<div class="math notranslate nohighlight">
\[\sigma_{i,\mathrm{eff}} = \sqrt{ \sigma_i^2 + \left( \sigma * \bar{\sigma} \right)^2 }\]</div>
<p>For bolometric light curve fitting, you can also set a maximum for this intrinsic scatter using the <code class="docutils literal notranslate"><span class="pre">sigma_max</span></code> keyword (default: 10). (For model fitting, you can set a maximum using the <code class="docutils literal notranslate"><span class="pre">priors</span></code> keyword.)</p>
</section>
</section>
<section id="model-fitting">
<h2>Model Fitting<a class="headerlink" href="#model-fitting" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="api.html#module-lightcurve_fitting.models" title="lightcurve_fitting.models"><code class="xref py py-mod docutils literal notranslate"><span class="pre">models</span></code></a> and <a class="reference internal" href="api.html#module-lightcurve_fitting.fitting" title="lightcurve_fitting.fitting"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fitting</span></code></a> submodules allow you to fit analytical models to the observed data.
Right now, there are two classes of models: <a class="reference internal" href="api.html#lightcurve_fitting.models.BaseCompanionShocking" title="lightcurve_fitting.models.BaseCompanionShocking"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseCompanionShocking</span></code></a>, which is the SiFTO Type Ia supernova template <a class="reference internal" href="index.html#c08" id="id1"><span>[C08]</span></a> plus a shock component from <a class="reference internal" href="index.html#k10" id="id2"><span>[K10]</span></a>, and <a class="reference internal" href="api.html#lightcurve_fitting.models.BaseShockCooling" title="lightcurve_fitting.models.BaseShockCooling"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseShockCooling</span></code></a>, which is the <a class="reference internal" href="index.html#sw17" id="id3"><span>[SW17]</span></a> model for shock cooling in a core-collapse supernova.
The variations on these classes are as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="api.html#lightcurve_fitting.models.CompanionShocking" title="lightcurve_fitting.models.CompanionShocking"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompanionShocking</span></code></a> uses factors on the r and i SiFTO models and a factor on the U shock component.
This was used in my paper on SN 2017cbv <a class="reference internal" href="index.html#h17" id="id4"><span>[H17]</span></a>.</p></li>
<li><p><a class="reference internal" href="api.html#lightcurve_fitting.models.CompanionShocking2" title="lightcurve_fitting.models.CompanionShocking2"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompanionShocking2</span></code></a> uses time offsets for the U and i SiFTO models.
This was used in my paper on SN 2021aefx <a class="reference internal" href="index.html#h22a" id="id5"><span>[H22a]</span></a>.</p></li>
<li><p><a class="reference internal" href="api.html#lightcurve_fitting.models.CompanionShocking3" title="lightcurve_fitting.models.CompanionShocking3"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompanionShocking3</span></code></a> is the same as <a class="reference internal" href="api.html#lightcurve_fitting.models.CompanionShocking2" title="lightcurve_fitting.models.CompanionShocking2"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompanionShocking2</span></code></a> but includes viewing angle dependence.</p></li>
<li><p><a class="reference internal" href="api.html#lightcurve_fitting.models.ShockCooling" title="lightcurve_fitting.models.ShockCooling"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShockCooling</span></code></a> is formulated in terms of physical parameters <span class="math notranslate nohighlight">\(v_s, M_\mathrm{env}, f_ρ M, R\)</span>.</p></li>
<li><p><a class="reference internal" href="api.html#lightcurve_fitting.models.ShockCooling2" title="lightcurve_fitting.models.ShockCooling2"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShockCooling2</span></code></a> is formulated in terms of scaling parameters <span class="math notranslate nohighlight">\(T_1, L_1, t_\mathrm{tr}\)</span>.
This was used in my paper on SN 2016bkv <a class="reference internal" href="index.html#h18" id="id6"><span>[H18]</span></a>.</p></li>
<li><p><a class="reference internal" href="api.html#lightcurve_fitting.models.ShockCooling3" title="lightcurve_fitting.models.ShockCooling3"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShockCooling3</span></code></a> is the same as <a class="reference internal" href="api.html#lightcurve_fitting.models.ShockCooling" title="lightcurve_fitting.models.ShockCooling"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShockCooling</span></code></a> but with <span class="math notranslate nohighlight">\(d_L\)</span> and <span class="math notranslate nohighlight">\(E(B-V)\)</span> as free parameters. (Therefore it fits the flux instead of the luminosity.) This was used in my paper on SN 2021yja <a class="reference internal" href="index.html#h22b" id="id7"><span>[H22b]</span></a>.</p></li>
</ul>
</div></blockquote>
<p><strong>Note on the shock cooling models:</strong>
There are degeneracies between many of the physical parameters that make them difficult to fit independently.
This led us to fit develop the <code class="xref py py-data docutils literal notranslate"><span class="pre">ShockCooling2</span></code> model just to see if the model could fit the data at all.
Since it did not fit well, we concluded that the physical parameters we could have obtained by fitting the <code class="xref py py-data docutils literal notranslate"><span class="pre">ShockCooling</span></code> model were irrelevant.
However, in order to measure, for example, the progenitor radius, one must use the <code class="xref py py-data docutils literal notranslate"><span class="pre">ShockCooling</span></code> model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightcurve_fitting.models</span> <span class="kn">import</span> <span class="n">ShockCooling2</span><span class="p">,</span> <span class="n">UniformPrior</span>
<span class="kn">from</span> <span class="nn">lightcurve_fitting.fitting</span> <span class="kn">import</span> <span class="n">lightcurve_mcmc</span><span class="p">,</span> <span class="n">lightcurve_corner</span>

<span class="c1"># Fit only the early light curve</span>
<span class="n">lc_early</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">MJD_min</span><span class="o">=</span><span class="mf">57468.</span><span class="p">,</span> <span class="n">MJD_max</span><span class="o">=</span><span class="mf">57485.</span><span class="p">)</span>

<span class="c1"># Define the priors and initial guesses</span>
<span class="n">priors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">UniformPrior</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">),</span>
    <span class="n">UniformPrior</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">),</span>
    <span class="n">UniformPrior</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">),</span>
    <span class="n">UniformPrior</span><span class="p">(</span><span class="mf">57468.</span><span class="p">,</span> <span class="mf">57468.7</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">p_lo</span> <span class="o">=</span> <span class="p">[</span><span class="mf">20.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">,</span> <span class="mf">57468.5</span><span class="p">]</span>
<span class="n">p_up</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">50.</span><span class="p">,</span> <span class="mf">57468.7</span><span class="p">]</span>

<span class="c1"># Initialize the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ShockCooling2</span><span class="p">(</span><span class="n">lc_early</span><span class="p">)</span>

<span class="c1"># Run the fit</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">lightcurve_mcmc</span><span class="p">(</span><span class="n">lc_early</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">p_lo</span><span class="o">=</span><span class="n">p_lo</span><span class="p">,</span> <span class="n">p_up</span><span class="o">=</span><span class="n">p_up</span><span class="p">,</span>
                          <span class="n">nwalkers</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nsteps_burnin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot the results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_corner</span><span class="p">,</span> <span class="n">ax_model</span> <span class="o">=</span> <span class="n">lightcurve_corner</span><span class="p">(</span><span class="n">lc_early</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">flatchain</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Another note on the shock cooling models:</strong>
The shock cooling models are only valid for temperatures above 0.7 eV = 8120 K <a class="reference internal" href="index.html#sw17" id="id8"><span>[SW17]</span></a>,
so you should check that you have not included observations where the model goes below that.
If you have, you should rerun the fit without those points.
If you used the <a class="reference internal" href="index.html#rw11" id="id9"><span>[RW11]</span></a> option, the model fails even earlier, but you will have to check that manually.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p_mean</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">flatchain</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">t_max</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">t_max</span><span class="p">(</span><span class="n">p_mean</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t_max</span><span class="p">)</span>
<span class="k">if</span> <span class="n">lc_early</span><span class="p">[</span><span class="s1">&#39;MJD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">t_max</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: your model is not valid for all your observations&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that you can add an <a class="reference internal" href="#intrinsic-scatter"><span class="std std-ref">Intrinsic Scatter</span></a> to your model fits as well.</p>
<section id="defining-new-models-advanced">
<h3>Defining New Models (Advanced)<a class="headerlink" href="#defining-new-models-advanced" title="Permalink to this heading">¶</a></h3>
<p>If you want to define a new model, all you need to do is subclass the <a class="reference internal" href="api.html#lightcurve_fitting.models.Model" title="lightcurve_fitting.models.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> class.
Implement the model in the <a class="reference internal" href="api.html#lightcurve_fitting.models.Model.evaluate" title="lightcurve_fitting.models.Model.evaluate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.evaluate()</span></code></a> method, which takes an array of times and an array of filters as the first two arguments, followed by the physical parameters of the model.
If there are keyword arguments (parameters that are <em>not</em> fit for) that need to be specified, you may have to override the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.__init__()</span></code> method.
You must also provide <code class="docutils literal notranslate"><span class="pre">input_names</span></code> and <code class="docutils literal notranslate"><span class="pre">units</span></code> as class variables.</p>
</section>
</section>
<section id="calibrating-spectra-to-photometry">
<h2>Calibrating Spectra to Photometry<a class="headerlink" href="#calibrating-spectra-to-photometry" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="api.html#module-lightcurve_fitting.speccal" title="lightcurve_fitting.speccal"><code class="xref py py-mod docutils literal notranslate"><span class="pre">speccal</span></code></a> module (somewhat experimental right now) can be used to calibrate spectra to observed photometry.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightcurve_fitting.speccal</span> <span class="kn">import</span> <span class="n">calibrate_spectra</span>

<span class="n">spectra_filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blah.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;blah.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;blah.dat&#39;</span><span class="p">]</span>
<span class="n">calibrate_spectra</span><span class="p">(</span><span class="n">spectra_filenames</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Each spectrum is multiplied by the filter transmission function and integrated to produce a synthetic flux measurement.
Each magnitude in the light curve is also converted to flux.
The ratios of these two flux measurements (for each filter) are fit with a polynomial (order 0 by default).
Multiplying by this best-fit polynomial calibrates the spectrum to the photometry.
Each calibrated spectrum is saved to a text file with the prefix <code class="docutils literal notranslate"><span class="pre">photcal_</span></code>.
I recommend using <code class="docutils literal notranslate"><span class="pre">show=True</span></code> to visualize the process.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Griffin Hosseinzadeh.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>